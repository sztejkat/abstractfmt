<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
  <title>sztejkat.abstractfmt.bin - BIN un-described format definition</title>
      
  <meta http-equiv="content-type"
 content="text/html; charset=UTF-8">
</head>
<body>
		<h1>BIN format definition, undescribed</h1>
		This documents defines header and payload encoding
		for chunk-based, undescribed binary format.
		
		<h2>Headers</h2>
		First byte of header decides on what header
		we are talking about.
		
		<pre>
		 bit 7    bit 0
		    xxxx TTTT
		</pre>
		<p>
		<i>Note: Primary difference between this format header 
		and a <A href="chunk-syntax-described.html#HEADER">described format</a>
		header is the number of bits reserved for header type. Four in this format, five in described format.
		Effectively small type chunks in un-described format may be twice as big as in described format.
		</i>
		 
		
		<table border="1">
			<tr style="background-color:#FA7F7F;">
				<td>T TTTT</td><td>header type</td>
			</tr>
			<tr>
				<td>0x00</td><td><a href="#BEGIN_DIRECT">BEGIN_DIRECT</a></td>
			</tr>
			<tr>
				<td>0x01</td><td><a href="#BEGIN_REGISTER">BEGIN_REGISTER</a></td>
			</tr>
			<tr>
				<td>0x02</td><td><a href="#BEGIN_USE">BEGIN_USE</a></td>
			</tr>
			<tr>
				<td>0x03</td><td><a href="#END">END</a></td>
			</tr>
			<tr>
				<td>0x04</td><td><a href="#END_BEGIN_DIRECT">END_BEGIN_DIRECT</a></td>
			</tr>
			<tr>
				<td>0x05</td><td><a href="#END_BEGIN_REGISTER">END_BEGIN_REGISTER</a></td>
			</tr>
			<tr>
				<td>0x06</td><td><a href="#END_BEGIN_USE">END_BEGIN_USE</a></td>
			</tr>
			
			<tr>
				<td>0x07</td><td><a href="#DATA_short">DATA (short)</a></td>
			</tr>
			<tr>
				<td>0x08</td><td><a href="#DATA_medium">DATA (medium)</a></td>
			</tr>
			<tr>
				<td>0x09</td><td><a href="#DATA_long">DATA (long)</long></td>
			</tr>
			<tr>
				<td>0xA...0xF</td><td>reserved</td>
			</tr>
			
		</table>
		
		<h3 id="DATA_short">DATA (short)</h3>
		<pre>
			ssss_TTTT
			   (0x07)
		</pre>
		where <code>ssss</code> is a payload size minus one.
		<p>
		<i>Note: DATA chunks with zero payload are not written into stream</i>
		<p>
		This chunk can then carry 1...16 bytes of payload.
		
		
		<h3 id="DATA_medium">DATA (medium)</h3>
		<pre>
			ssss_TTTT
			   (0x08)
			aaaa aaaa
		</pre>
		where:<pre>aaaa aaaa ssss</pre> is the size of payload minus one.
		<p>
		<i>Note: DATA chunks with zero payload are not written into stream</i>
		<p>
		This chunk can then carry 1...4096 bytes of payload.
		
		
		
		<h3 id="DATA_long">DATA (long)</h3>
		<pre>
			0000_TTTT
			   (0x1A)
			aaaa aaaa
			bbbb bbbb
		</pre>
		where:<pre>bbbb bbbb aaaa aaaa</pre> is the size of payload minus one.
		<p>
		<i>Note: DATA chunks with zero payload are not written into stream</i>
		<p>
		This chunk can then carry 1...65536 bytes of payload.
		<p>
		<i>Note: I intentionally did zero <code>sss</code> bits, since the buffer
		must be pre-allocated and 512k would be a bit too much in my opinion.</i>
		<p>
		
		
		<h3 id="BEGIN_DIRECT">BEGIN_DIRECT</h3>
		<pre>
			ssss_TTTT
			   (0x00)			
		</pre>
		where <code>ssss</code> is the size of payload minus 3
		(as 3 bytes is what it takes to encode "end-of-name") 
		<p>
		The header is otherwise used the same way
		as in <a href="chunk-syntax-described.html#BEGIN_DIRECT">described format.</a>
		
		
		<h3 id="BEGIN_REGISTER">BEGIN_REGISTER</h3>
		This header is using the same format, except TTTT code value,
		as <A href="#BEGIN_DIRECT">BEGIN_DIRECT</a>
		<p>
		The header is otherwise used the same way
		as in <a href="chunk-syntax-described.html#BEGIN_REGISTER">described format.</a>
		
		
		<h3 id="BEGIN_USE">BEGIN_USE</h3>
		<pre>
			ssss_TTTT
			   (0x02)			
			iiii iiii
		</pre>
		where
		<ul>
			<li><code>ssss</code> is the size of payload (can be zero);</li>
			<li><code>iiii iiii</code> is the index of signal name, as registered previously</li>
		</ul>
		<p>
		This header has no special use requirements.
		
		
		<h3 id="END">END</h3>
		<pre>
			ssss_TTTT
			   (0x03)
		</pre>
		where <code>ssss</code> is the size of payload (can be zero);
		<p>
		This header has no special use requirements.
		
		<h3 id="END_BEGIN_DIRECT">END_BEGIN_DIRECT</h3>
		This header is using the same format, except TTTT code value,
		as <A href="#BEGIN_DIRECT">BEGIN_DIRECT</a>
		
		<h3 id="END_BEGIN_REGISTER">END_BEGIN_REGISTER</h3>
		This header is using the same format, except TTTT code value,
		as <A href="#BEGIN_REGISTER">BEGIN_REGISTER</a>
		
		
		<h3>Primitive data encoding</h3>
		Data are encoded without any information about where they begin or
		end.
		<p>
		Except single primitive boolean, which is always encoded as byte,
		all others, including blocks, are encoded exactly as in 
		<a href="chunk-syntax-described.html#TYPE_BYTE">described format.</a> 
				
</body>
</html>
